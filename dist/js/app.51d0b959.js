(function(e){function t(t){for(var o,s,u=t[0],c=t[1],i=t[2],p=0,f=[];p<u.length;p++)s=u[p],r[s]&&f.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);l&&l(t);while(f.length)f.shift()();return a.push.apply(a,i||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,u=1;u<n.length;u++){var c=n[u];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=t,u=u.slice();for(var i=0;i<u.length;i++)t(u[i]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var o=n("64a9"),r=n.n(o);r.a},2412:function(e,t,n){e.exports=n.p+"img/xiaoe_logo.4aaf20da.png"},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},a=[],s={name:"app",components:{}},u=s,c=(n("034f"),n("2877")),i=Object(c["a"])(u,r,a,!1,null,null,null),l=i.exports,p=n("081a"),f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"container"},[o("img",{staticClass:"logo-img",attrs:{src:n("2412")}}),o("Form",{ref:"formCustom",staticClass:"form-container",attrs:{model:e.formCustom,rules:e.ruleCustom,"label-width":80}},[o("FormItem",{attrs:{label:"Account",prop:"account"}},[o("Input",{attrs:{type:"text",placeholder:"Username"},model:{value:e.formCustom.account,callback:function(t){e.$set(e.formCustom,"account",t)},expression:"formCustom.account"}},[o("Icon",{attrs:{slot:"prepend",type:"ios-person-outline"},slot:"prepend"})],1)],1),o("FormItem",{attrs:{label:"Password",prop:"passwd"}},[o("Input",{attrs:{type:"password",placeholder:"Password"},model:{value:e.formCustom.passwd,callback:function(t){e.$set(e.formCustom,"passwd",t)},expression:"formCustom.passwd"}},[o("Icon",{attrs:{slot:"prepend",type:"ios-lock-outline"},slot:"prepend"})],1)],1),o("FormItem",{staticClass:"bottom-item"},[o("Button",{attrs:{type:"primary"},on:{click:function(t){return e.siginInClick("formCustom")}}},[e._v("登陆")])],1),o("FormItem",{staticClass:"bottom-item"},[o("Button",{attrs:{type:"primary"},on:{click:function(t){return e.signUpClick("formCustom")}}},[e._v("注册")])],1)],1)],1)},m=[],d=n("7f43"),g=n.n(d);n("4917"),n("3b2b");function h(e,t){var n=30,o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),document.cookie=e+"="+escape(t)+";expires="+o.toGMTString()}function v(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return t=document.cookie.match(n),console.log("arr is ",t),t?unescape(t[2]):null}var b={data:function(){var e=function(e,t,n){""===t?n(new Error("Please enter your password")):n()},t=function(e,t,n){if(!t)return n(new Error("account cannot be empty"));n()};return{formCustom:{account:"",passwd:""},ruleCustom:{passwd:[{validator:e,trigger:"blur"}],account:[{validator:t,trigger:"blur"}]}}},methods:{siginInClick:function(e){var t=this;this.$refs[e].validate(function(e){e?g()({method:"post",url:"http://127.0.0.1:5000/v1/api/admins/sign_in",data:{admin:{name:t.formCustom.account,password:t.formCustom.passwd}},headers:{"Content-Type":"text/plain"}}).then(function(e){0==e["data"].code?(t.$Message.success("登录成功"),h("app_version_manager",e["data"].data.auth_token),t.$router.push({name:"homepage"})):3e3==e["data"].code?t.$Message.error("登录失败"):(e["data"].code,t.$Message.error("登录失败"))}).catch(function(e){console.log("登录失败1",e),t.$Message.error("登录失败")}):t.$Message.error("帐号密码格式不正确")})},signUpClick:function(e){var t=this;this.$refs[e].validate(function(e){e?g()({method:"post",url:"http://127.0.0.1:5000/v1/api/admins/sign_up",data:{admin:{name:t.formCustom.account,password:t.formCustom.passwd}},headers:{"Content-Type":"text/plain"}}).then(function(e){console.log("注册成功",e),0==e["data"].code?(t.$Message.success("注册成功"),h("app_version_manager",e["data"].data.auth_token),t.$router.push({name:"homepage"})):t.$Message.error("注册失败")}).catch(function(e){console.log("注册失败",e),t.$Message.error("登录失败")}):t.$Message.error("帐号密码格式不正确")})}}},w=b,_=(n("7638"),Object(c["a"])(w,f,m,!1,null,"996cafdc",null)),C=_.exports,y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},k=[],$=n("795b"),x=n.n($),M=n("5176"),O=n.n(M),j={data:function(){return{}},beforeRouteEnter:function(e,t,n){var o=g.a.create({timeout:15e3});o.interceptors.request.use(function(e){return O()(e.headers,{"Access-Control-Allow-Origin":"*"}),e},function(e){x.a.reject(e)}),g()("http://127.0.0.1:5000/v1/api/test_token",{method:"get",headers:{Authorization:"Bearer "+v("app_version_manager")}}).then(function(e){console.log("token ok",e,v("app_version_manager")),0==e["data"].code?n():n({path:"/login"})}).catch(function(e){console.log("token fail",e,v("app_version_manager")),n({path:"/login"})})}},I=j,P=Object(c["a"])(I,y,k,!1,null,null,null),T=P.exports,E=[{path:"/",name:"app",component:l,redirect:"/login",children:[{path:"/homepage",name:"homepage",component:T},{path:"/login",name:"login",component:C}]}],S=n("9a8c"),F=n.n(S);n("632c");o["default"].use(p["a"]),o["default"].use(F.a);var A=new p["a"]({routes:E});o["default"].config.productionTip=!1,new o["default"]({router:A,render:function(e){return e(l)}}).$mount("#app")},"64a9":function(e,t,n){},7638:function(e,t,n){"use strict";var o=n("c360"),r=n.n(o);r.a},c360:function(e,t,n){}});
//# sourceMappingURL=app.51d0b959.js.map